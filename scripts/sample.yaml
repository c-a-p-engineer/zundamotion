meta:
  title: "キャラクターごとのデフォルト設定サンプル"
  version: 3

video:
  fps: 30
  # ゆっくり的 口パク/目パチ（差分PNGが存在すれば自動適用）
  face_anim:
    mouth_fps: 15           # 口パク判定のサンプリングFPS
    mouth_thr_half: 0.2     # 半開き閾値（RMSのmax比）
    mouth_thr_open: 0.5     # 全開閾値（RMSのmax比）
    blink_min_interval: 2.0 # 目パチの最小間隔（秒）
    blink_max_interval: 5.0 # 目パチの最大間隔（秒）
    blink_close_frames: 2   # 瞬きの閉眼フレーム数（動画FPS基準）

defaults:
  characters:
    copetan:
      speaker_id: 3
      speed: 1.1
      pitch: 0.05
      subtitle:
        font_color: "#90EE90" # LightGreen
        stroke_color: "white"
    engy:
      speaker_id: 8
      speed: 0.95
      subtitle:
        font_color: "#E6E6FA" # Lavender
        stroke_color: "black"

subtitle:
  font_path: "/usr/share/fonts/opentype/ipafont-gothic/ipag.ttf" # IPAexGothic font path
  size: 48
  color: "white"
  outline: "black"
  wrap_mode: chars 
  max_chars_per_line: 28 
  # インライン読みを字幕に括弧付きで表示する（none|paren）
  reading_display: paren

scenes:
  - id: subtitle_copetan
    bg: "assets/bg/room.png"
    fg_overlays:
      - id: sakura
        src: "assets/overlay/sakura_bg_black.mp4"
        mode: chroma
        chroma:
          key_color: "#000000"
          similarity: 0.1
          blend: 0.0
        position: {x: 0, y: 0}
        scale: {w: 1920, h: 1080, keep_aspect: true}
        timing:
          start: 0.0
          duration: 5.0
          loop: true
      - id: speedlines_img_effects
        src: "assets/overlay/speedlines.png"
        mode: overlay  # 元色を保つ（色被りを避ける）
        opacity: 0.9
        position: {x: 0, y: 0}
        scale: {w: 1920, h: 1080, keep_aspect: true}
        fps: 30
        effects:
          - type: blur
            sigma: 2.5
          - type: eq
            contrast: 1.02
            saturation: 1.0
          - type: rotate
            degrees: 0.0
        timing:
          start: 0.0
          duration: 5.0
    lines:
      - text: "こんにちは！こぴぺたんです。この字幕はキャラクターデフォルト色なのだ。"
        speaker_name: "copetan"
        characters:
          - name: "copetan"
            expression: "default"
            enter: true
            enter_duration: 0.5 # 登場→0.5秒後に音声開始
            anchor: bottom_center
            scale: 0.8

      - text: "このセリフだけ、字幕の色を変えてみるのだ。"
        speaker_name: "copetan"
        subtitle:
          font_color: "yellow" # この行だけデフォルトを上書き

      - text: "字幕の手動改行サンプルを紹介するのだ。"
        speaker_name: "copetan"
        subtitle_text: "手動改行の例だよ\\nPNGと字幕ファイルで2行になるのだ。"
        reading: "手動改行の例だよ。PNGと字幕ファイルで二行になるのだ。"
        # `\\n` を差し込むと字幕PNG/SRT/ASSでも改行が反映される

      - text: "私はエンジー。私の字幕もデフォルト設定よ。"
        speaker_name: "engy"
        characters:
          - name: "copetan"
            leave: slide_right
            leave_duration: 0.5
          - name: "engy"
            expression: "default"
            enter: slide_left
            anchor: bottom_center
            position:
              x: 480
              y: -20
            scale: 0.8

      - text: "このプロジェクト、なかなか面白いじゃない。"
        speaker_name: "engy"

  - id: voice_copetan
    bg: "assets/bg/room.png"
    lines:
      - text: "こんにちは！こぴぺたんです。これは桜の前景とデフォルト設定で話しているのだ。"
        speaker_name: "copetan"
        characters:
          - name: "copetan"
            expression: "default"
            visible: true
            anchor: "middle_left"
        fg_overlays:
          - id: line_sakura
            src: "assets/overlay/sakura_bg_black.mp4"
            mode: chroma
            chroma:
              key_color: "#000000"
              similarity: 0.1
              blend: 0.0
            position: {x: 0, y: 0}
            scale: {w: 1920, h: 1080, keep_aspect: true}
            timing:
              loop: true
          - id: line_speedlines
            src: "assets/overlay/speedlines.png"
            mode: overlay  # 元色を保つ（色被りを避ける）
            opacity: 0.85
            position: {x: 0, y: 0}
            scale: {w: 1920, h: 1080, keep_aspect: true}
            fps: 30
            effects:
              - type: blur
                sigma: 2.0
              - type: eq
                contrast: 1.02
                saturation: 1.0
            timing:
              start: 0.0
              duration: 4.0

      - text: "このセリフだけ、少しゆっくり話してみるのだ。"
        speaker_name: "copetan"
        speed: 0.9 # この行だけデフォルトを上書き

      - text: "私はエンジー。私もデフォルト設定よ。"
        speaker_name: "engy"
        characters:
          - name: "engy"
            expression: "default"
            visible: true
            anchor: "middle_right"
            scale: 0.8

      - text: "このプロジェクト、なかなか面白いじゃない。"
        speaker_name: "engy"
        pitch: -0.1 # この行だけデフォルトを上書き

  - id: intro
    bg: "assets/bg/sample_video.mp4"    # シーン背景 (動画ファイル)
    bgm:                                # BGM設定
      path: "assets/bgm/intro.wav"      # BGMファイルパス
      volume: 0.1                       # BGM音量 (0.0-1.0, オプション)
      fade_in_duration: 2.0             # フェードインの長さ (秒, オプション)
      fade_out_duration: 1.5            # フェードアウトの長さ (秒, オプション)
    lines:
      - wait: 2
      - text: "背景ビデオと効果音、待機のテストなのだ！" # セリフテキスト (必須)
        speaker_id: 3 # 明示的にVOICEVOX ID 3 を指定
        speaker_name: "copetan" # 話しているキャラクターの名前
        sound_effects: # セリフと同時に再生する効果音
          - path: "assets/se/rap_fanfare.mp3"
            start_time: 3.0 # セリフ開始と同時に再生
            volume: 0.5

      - wait: 2
      - text: "" # 音単体で再生する効果音
        sound_effects:
          - path: "assets/se/rap_fanfare.mp3"
            start_time: 0.0 # シーン開始から0.0秒後に再生 (デフォルト: 0.0)
            volume: 0.7 # (デフォルト: 1)

      - text: "これから自己紹介の動画をはじめるのだ。"
        speaker_id: 3 # こぴぺたんのスピーカーID
        speaker_name: "copetan" # 話しているキャラクターの名前
        characters: # キャラクター設定リスト
          - name: "copetan"
            expression: "whisper" # voice_style: whisper を expression: whisper に変更
            position: {"x": "0", "y": "0"}
            scale: 0.8
            anchor: "bottom_center"
            visible: true
        speed: 1.1                      # 音声速度 (0.5-2.0, オプション)
      - text: "最後まで見てくれると嬉しいのだ！"
        voice_style: whisper # キャラクター定義のwhisperスタイルを使用
        speaker_name: "copetan" # 話しているキャラクターの名前
        characters: # キャラクター設定リスト
          - name: "copetan"
            expression: "default" # 元のvoice_style: whisper から normal に戻す（例として）
            position: {"x": "0", "y": "0"}
            scale: 0.8
            anchor: "bottom_right"
            visible: true
        pitch: 0.3                      # 音声ピッチ (-1.0-1.0, オプション)
    transition: # introシーンの後に適用されるトランジション
      type: "fade" # トランジションの種類 (例: fade, dissolve, wipeleftなど)
      duration: 1.0 # トランジションの期間 (秒)

  - id: topic
    bg: "assets/bg/street.png"
    bgm:                                # BGM設定
      path: "assets/bgm/street.wav"     # BGMファイルパス
      volume: 0.2                       # BGM音量 (0.0-1.0, オプション)
    lines:
      - wait: 2
      - text: "私はエンジーよ" # セリフテキスト (必須)
        speaker_id: 8 # 明示的にVOICEVOX ID 8 を指定
        speaker_name: "engy" # 話しているキャラクターの名前
        characters: # キャラクター設定リスト
          - name: "engy"
            expression: "default" # voice_style: normal を expression: normal に変更
            position: {"x": "0", "y": "0"} # アンカーポイントからのオフセット (ピクセル単位)
            scale: 0.8
            anchor: "middle_center"
            visible: true
      - text: "趣味は新しいツールを試すこと！"
        speaker_id: 8 # エンジーのスピーカーID
        speaker_name: "engy" # 話しているキャラクターの名前
        characters: # キャラクター設定リスト
          - name: "engy"
            expression: "default" # voice_style: normal を expression: normal に変更
            position: {"x": "0", "y": "0"}
            scale: 0.8
            anchor: "bottom_center"
            visible: true
        speed: 0.95                     # 音声速度 (0.5-2.0, オプション)
      - text: "このチャンネルでは、便利なスクリプトや動画制作のコツを紹介するのよ。"
        speaker_id: 8 # 明示的にVOICEVOX ID 8 を指定
        speaker_name: "engy" # 話しているキャラクターの名前

  # 読み分けデモ（インライン/行オプション）
  - id: reading_demo
    bg: "assets/bg/room.png"
    lines:
      - speaker_name: "copetan"
        # インライン読みマークアップ: [表示|読み] と 波括弧: 表示{読み}
        text: "それ[本気|ホンキ]？[本気|マジ]？ 本気{マジ}でいく？"
        characters:
          - name: "copetan"
            expression: "default"
            visible: true
            anchor: "bottom_center"
            position: {"x": "0", "y": "0"}
            scale: 0.8

      - speaker_name: "copetan"
        # 行全体の読みを差し替える例（インライン無しでもOK）
        text: "本気です！"
        reading: "マジです！"
        characters:
          - name: "copetan"
            expression: "default"
            visible: true
            anchor: "bottom_center"
            position: {"x": "0", "y": "0"}
            scale: 0.8
        characters: # キャラクター設定リスト
          - name: "engy"
            expression: "default" # voice_style: normal を expression: normal に変更
            position: {"x": "0", "y": "0"}
            scale: 0.8
            anchor: "bottom_center"
            visible: true
    transition: # topicシーンの後に適用されるトランジション
      type: "dissolve" # 別のトランジションタイプを試す
      duration: 0.8 # 短めの期間

  - id: outro
    bg: "assets/bg/sunset.png"
    bgm:                                # BGM設定
      path: "assets/bgm/sunset.wav"     # BGMファイルパス
      volume: 0.3                       # BGM音量 (0.0-1.0, オプション)
      start_time: 1.0                   # BGMの開始時間 (秒, オプション)
    lines:
      - wait: 2
      - text: "今日は見てくれて、ありがとうなのだ！" # セリフテキスト (必須)
        speaker_id: 3 # キャラクター名 (必須, assets/characters/以下にディレクトリが存在すること)
        speaker_name: "copetan" # 話しているキャラクターの名前
        characters: # キャラクター設定リスト
          - name: "copetan"
            expression: "default" # expression を normal に設定
            position: {"x": "300", "y": "500"}
            visible: true
      - text: "（画像を右下に小さく表示するのだ）"
        speaker_id: 3
        speaker_name: "copetan"
        insert:
          path: "assets/bg/room.png"
          duration: 3.0
          scale: 0.3
          anchor: "bottom_right"
          position: {"x": "-20", "y": "-20"}
      - text: "（動画を再生するのだ！）"
        speaker_id: 3
        speaker_name: "copetan"
        insert:
          path: "assets/bg/countdown.mp4"
          scale: 0.8
          anchor: "middle_center"
          position: {"x": "20", "y": "20"}
          volume: 0.2
      - text: "チャンネル登録と高評価、よろしくお願いします！"
        speaker_id: 3 # こぴぺたんのスピーカーID
        speaker_name: "copetan" # 話しているキャラクターの名前
        characters: # キャラクター設定リスト
          - name: "copetan"
            expression: "default" # expression を normal に設定
            position: {"x": "300", "y": "500"}
            visible: true
        speed: 1.05                     # 音声速度 (0.5-2.0, オプション)
